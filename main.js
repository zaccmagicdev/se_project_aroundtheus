!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input_error_visible"},t=document.querySelector("#edit-button"),s=document.querySelector(".profile__add-button"),r=document.querySelector("#profile__modal-form"),n=document.querySelector("#add-image__modal-form"),i=document.querySelector("#edit-avatar__pic-form"),o=document.querySelector("#profile-modal__input-name"),a=document.querySelector("#profile-modal__input-description"),l=document.querySelector(".profile__avatar-button"),d=document.querySelector(".profile__avatar");class c{constructor(e,t,s,r,n){let{name:i,link:o,id:a,likeStatus:l}=e;this._name=i,this._link=o,this._id=a,this._likeStatus=l,this._cardSelector=t,this._handleCardClick=s,this._handleDeleteCard=r,this._handleCardLike=n}_handleLikeButton(){this._cardElement.querySelector(".card__like-button").classList.toggle("card__like-button_clicked")}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLikeButton(),this._handleCardLike()})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._handleDeleteCard()})),this._cardElement.querySelector("#card-image-button").addEventListener("click",(()=>{this._handleCardClick({name:this._name,link:this._link})})),this._checkStatus()}delete(){this._cardElement.remove()}_checkStatus(){const e=this._cardElement.querySelector(".card__like-button");this._likeStatus?e.classList.add("card__like-button_clicked"):e.classList.remove("card__like-button_clicked")}generateCard(){this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0);const e=this._cardElement.querySelector(".card__caption"),t=this._cardElement.querySelector(".card__image");return e.textContent=this._name,t.setAttribute("alt",this._name),t.setAttribute("src",this._link),this._setEventListeners(),this._cardElement}}class h{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(e){return!e.every((e=>e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this._disableButton():(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled",!0))}_disableButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}_setEventListeners(){this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(t=>{t.preventDefault(),this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this._disableButton()})),this._setEventListeners()}}class u{constructor(e){this._modal=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}open(){this._modal.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._modal.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._modal.querySelector(".modal__exit-button").addEventListener("click",(()=>{this.close()})),this._modal.addEventListener("mousedown",(e=>{this._modal.classList.contains("modal_opened")&&e.target===this._modal&&this.close()}))}}class _ extends u{constructor(e,t){super(e),this._modalForm=this._modal.querySelector(".modal__form"),this._modalButton=this._modal.querySelector(".modal__button"),this._modalButtonText=this._modalButton.textContent,this._modalInputs=this._modalForm.querySelectorAll(".modal__input"),this._handleFormSubmit=t}_getInputValues(){const e=new FormData(this._modalForm);return Object.fromEntries(e)}renderLoading(e){this._modalButton.textContent=e?"Saving...":this._modalButtonText}setEventListeners(){this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())})),super.setEventListeners()}close(){super.close(),this._modalForm.reset()}}const m=new class{constructor(e){this.url=e.url,this.headers=e.headers}async getUserData(){return fetch(this.url+"/users/me",{method:"GET",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async getInitialCards(){return fetch(this.url+"/cards",{method:"GET",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async uploadCard(e,t){return fetch(this.url+"/cards",{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async deleteCard(e){fetch(this.url+`/cards/${e}`,{method:"DELETE",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async getCardsAndUserData(){return Promise.all([this.getInitialCards(),this.getUserData()])}async likeCard(e){return fetch(this.url+`/cards/${e}/likes`,{method:"PUT",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async unlikeCard(e){return fetch(this.url+`/cards/${e}/likes`,{method:"DELETE",headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async setProfileData(e,t){return fetch(this.url+"/users/me",{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}async updateProfilePic(e){return fetch(this.url+"/users/me/avatar",{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({url:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a087da59-6aa1-4dbf-8a2c-982e97da6080","Content-Type":"application/json"}});m.getCardsAndUserData().then((e=>{e[0].forEach((e=>{const t=y({name:e.name,link:e.link,id:e._id,likeStatus:e.isLiked});f.addItem(t)}));const{avatar:t,about:s,name:r}=e[1];d.src=t,p.setUserInfo({name:r,about:s})}));const p=new class{constructor(e,t){this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._jobElement.textContent=e.about}}("#user-name","#user-career"),E=new class extends u{constructor(e){super(e),this._modalImage=this._modal.querySelector(".modal__enlarged-image"),this._modalCaption=this._modal.querySelector(".modal__enlarged-text")}open(e,t){this._modalImage.setAttribute("src",t),this._modalImage.setAttribute("alt",e),this._modalCaption.textContent=e,super.open()}}("#enlarged-modal-box"),v=new class extends u{constructor(e,t){super(e),this._handleFormSubmit=t,this._modalForm=this._modal.querySelector(".modal__form"),this._submitButton=this._modalForm.querySelector(".modal__button")}open(e,t){super.open(),this._cardElement=e,this._id=t}close(){super.close()}setEventListeners(){this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._cardElement,this._id)})),super.setEventListeners()}}("#confirm-modal",(e=>{var t,s;t=e,s=e._id,m.deleteCard(s).then(t.delete()).catch((e=>console.log(e))),v.close()})),b=new _("#avatar-edit-modal",(e=>{b.renderLoading(!0),m.updateProfilePic(e["avatar-link"]).then((e=>d.src=e.avatar)).then(b.renderLoading(!1)).finally(b.close())})),k=new _("#add-modal-box",(e=>{k.renderLoading(!0),m.uploadCard(e["add-img-title"],e["add-img-link"]).then((e=>{const{name:t,link:s,_id:r,isLiked:n}=e;f.prependItem(y({name:t,link:s,id:r,likeStatus:n}))})).then(k.renderLoading(!1)).finally(k.close())})),S=new _("#profile-modal-box",(e=>{b.renderLoading(!0),m.setProfileData(e["profile-modal-username"],e["profile-modal-desc"]).then((e=>p.setUserInfo(e))).then(k.renderLoading(!1)).finally(S.close())}));function y(e){const t=new c(e,"#card-template",(()=>{E.open(e.name,e.link)}),(()=>{v.open(t,t._id)}),(()=>{e.likeStatus?m.unlikeCard(e.id).then((t=>{L(e,t.isLiked)})):m.likeCard(e.id).then((t=>{L(e,t.isLiked)}))}));return t.generateCard()}function L(e,t){e.likeStatus=t}S.setEventListeners(),k.setEventListeners(),E.setEventListeners(),v.setEventListeners(),b.setEventListeners();const f=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}({items:[],renderer:()=>{}},".cards");f.renderItems();const C=new h(e,n),g=new h(e,r),q=new h(e,i);C.enableValidation(),g.enableValidation(),q.enableValidation(),t.addEventListener("click",(()=>{S.open();const{name:e,job:t}=p.getUserInfo();o.value=e,a.value=t})),s.addEventListener("click",(()=>{k.open()})),l.addEventListener("click",(()=>{b.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bnRzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wVXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnID0gKHtcclxuICAgIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcclxuICAgIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcclxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbl9kaXNhYmxlZFwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF9lcnJvcl92aXNpYmxlXCJcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlZGl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgYWRkSW1hZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2ZpbGVfX21vZGFsLWZvcm0nKTtcclxuZXhwb3J0IGNvbnN0IGFkZEltYWdlRWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYWRkLWltYWdlX19tb2RhbC1mb3JtJyk7XHJcbmV4cG9ydCBjb25zdCBlZGl0QXZhdGFyRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlZGl0LWF2YXRhcl9fcGljLWZvcm0nKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0TmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Byb2ZpbGUtbW9kYWxfX2lucHV0LW5hbWUnKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0Sm9iSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvZmlsZS1tb2RhbF9faW5wdXQtZGVzY3JpcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYXZhdGFyLWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hdmF0YXInKTtcclxuIiwiXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gICAgY29uc3RydWN0b3IoeyBuYW1lLCBsaW5rLCBpZCwgbGlrZVN0YXR1c30sIGNhcmRTZWxlY3RvciwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVDYXJkRGVsZXRlLCBoYW5kbGVDYXJkTGlrZSkge1xyXG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xyXG4gICAgICAgIHRoaXMuX2lkID0gaWQ7XHJcbiAgICAgICAgdGhpcy5fbGlrZVN0YXR1cyA9IGxpa2VTdGF0dXM7XHJcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcclxuICAgICAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkID0gaGFuZGxlQ2FyZERlbGV0ZTtcclxuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZSA9IGhhbmRsZUNhcmRMaWtlO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVMaWtlQnV0dG9uKCkge1xyXG4gICAgICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2NsaWNrZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IFxyXG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTGlrZUJ1dHRvbigpXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZSgpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIikgXHJcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLl9oYW5kbGVEZWxldGVDYXJkKCkgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWFnZS1idXR0b25cIilcclxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMuX2hhbmRsZUNhcmRDbGljayh7bmFtZTogdGhpcy5fbmFtZSwgbGluazogdGhpcy5fbGlua30pIH0pO1xyXG5cclxuICAgICAgICB0aGlzLl9jaGVja1N0YXR1cygpOyAgICBcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGUoKXtcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudC5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBfY2hlY2tTdGF0dXMoKXtcclxuICAgICAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcclxuICAgICAgICBpZih0aGlzLl9saWtlU3RhdHVzKXtcclxuICAgICAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fY2xpY2tlZFwiKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2NsaWNrZWRcIilcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgICAgIC8vdGhpcyBpcyB3aGVyZSBpdCBnZXRzIGEgbGl0dGxlIGJpdCB0cmlja3kuLndlIG5lZWQgdG8gc2VsZWN0IG91ciBhcHByb3ByaWF0ZSBlbGVtZW50cyBhbmQgZmllbGRzIHRoZW4gcmV0dXJuIGEgY2FyZCBvYmplY3RcclxuICAgICAgICAvL3RoaXMgaXMgYWxzbyBnb2luZyB0byBiZSB3aGVyZSB3ZSBjYWxsIG91dCBzZXRFdmVudExpc3RlbmVycyBtZXRob2RcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgICAgICAgLmNvbnRlbnRcclxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgICAgICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAvL2dyYWJiaW5nIG91ciBtYWluIGVsZW1lbnRzIGZvciB0aGUgY2FyZCBhbmQgc2ltcGx5IGdpdmluZyB0aGVtIHRoZWlyIGF0dHJ1YnV0ZXMgbm93IGFzIGFuIG9iamVjdCEgICAgIFxyXG4gICAgICAgIGNvbnN0IGNhcmRUZXh0ID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19jYXB0aW9uXCIpO1xyXG4gICAgICAgIGNvbnN0IGNhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcblxyXG4gICAgICAgIGNhcmRUZXh0LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgICAgICBjYXJkSW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHRoaXMuX25hbWUpO1xyXG4gICAgICAgIGNhcmRJbWFnZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgdGhpcy5fbGluayk7XHJcblxyXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcclxuICAgIH1cclxufVxyXG4iLCIvL3RoaXMgaXMgZ29ubmEgYmUgb3VyIG9iamVjdCB0byBwYXNzIGlucHV0cyB0aHJvdWdoIGZvciB2YWxpZGF0aW9uXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgICAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgICAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XHJcblxyXG4gICAgICAgIHRoaXMuX2Zvcm0gPSBmb3JtO1xyXG4gICAgfVxyXG5cclxuICAgIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBpbnB1dEVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gICAgICAgIGlucHV0RXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgICAgIGlucHV0RXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgaW5wdXRFcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICAgICAgICBpbnB1dEVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICAgICAgaW5wdXRFcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gICAgICAgIHJldHVybiAhaW5wdXRMaXN0LmV2ZXJ5KChpbnB1dCkgPT4gaW5wdXQudmFsaWRpdHkudmFsaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuX2lucHV0TGlzdCkpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9kaXNhYmxlQnV0dG9uKCl7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xyXG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgfVxyXG59XHJcbiIsIlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgICBjb25zdHJ1Y3Rvcihtb2RhbCkge1xyXG4gICAgICAgIHRoaXMuX21vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbCk7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgICAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5fbW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfb3BlbmVkJyk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9vcGVuZWQnKTtcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gdGhpcy5fbW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZXhpdC1idXR0b25cIik7XHJcbiAgICAgICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLl9tb2RhbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fbW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9vcGVuZWQnKVxyXG4gICAgICAgICAgICAgICAgJiYgZS50YXJnZXQgPT09IHRoaXMuX21vZGFsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wVXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwe1xyXG4gICAgY29uc3RydWN0b3IobW9kYWwsIGhhbmRsZUZvcm1TdWJtaXQpe1xyXG4gICAgICAgIHN1cGVyKG1vZGFsKTtcclxuICAgICAgICB0aGlzLl9tb2RhbEZvcm0gPSB0aGlzLl9tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Zvcm0nKTtcclxuICAgICAgICB0aGlzLl9tb2RhbEJ1dHRvbiA9IHRoaXMuX21vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fYnV0dG9uJyk7XHJcbiAgICAgICAgdGhpcy5fbW9kYWxCdXR0b25UZXh0ID0gdGhpcy5fbW9kYWxCdXR0b24udGV4dENvbnRlbnQ7XHJcbiAgICAgICAgdGhpcy5fbW9kYWxJbnB1dHMgPSB0aGlzLl9tb2RhbEZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsX19pbnB1dCcpO1xyXG4gICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgfVxyXG5cclxuICAgIF9nZXRJbnB1dFZhbHVlcygpe1xyXG4gICAgICAgIC8vdGhpcyB3aWxsIGdldCBkYXRhIGZyb20gdGhlIGZpZWxkcyB3aXRoIGZvcm1zXHJcbiAgICAgICAgY29uc3QgX2Zvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRoaXMuX21vZGFsRm9ybSk7XHJcbiAgICAgICAgY29uc3QgX2lucHV0VmFscyA9IE9iamVjdC5mcm9tRW50cmllcyhfZm9ybURhdGEpO1xyXG4gICAgICAgIHJldHVybiBfaW5wdXRWYWxzO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKXtcclxuICAgICAgICBpZihpc0xvYWRpbmcpe1xyXG4gICAgICAgICAgICB0aGlzLl9tb2RhbEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fbW9kYWxCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9tb2RhbEJ1dHRvblRleHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCl7XHJcbiAgICAgICAgLy90aGlzIHdpbGwgbW9kaWZ5IHRoZSBwYXJlbnQgc2V0IGV2ZW50IGxpc3RlbmVycyBhbmQgbXVzdCBhZGQgXHJcbiAgICAgICAgLy90aGUgc3VibWl0IGZvcm0gaGFuZGxlciBhbmQgd2UgY2FsbCB0aGUgcGFyZW50IHNldGV2ZW50bGlzdGVuZXJzXHJcbiAgICAgICAgLy93ZSBjYW4gcHV0IG91ciBzdWJtaXQgY29kZSBpbiB0aGUgY2FsbGJhY2sgYW5kIGhhdmUgdGhlIHN1Ym1pdCBmaXJlIGhlcmVcclxuICAgICAgICB0aGlzLl9tb2RhbEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpe1xyXG4gICAgICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICAgICAgdGhpcy5fbW9kYWxGb3JtLnJlc2V0KCk7XHJcbiAgICB9XHJcbn0iLCIvL2ltcG9ydGluZyB3aGF0IHdlIG5lZWRcclxuaW1wb3J0IHtcclxuICAgIGVkaXRCdXR0b24sXHJcbiAgICBhZGRJbWFnZUJ1dHRvbixcclxuICAgIHByb2ZpbGVFZGl0Rm9ybSxcclxuICAgIGFkZEltYWdlRWRpdEZvcm0sXHJcbiAgICBlZGl0QXZhdGFyRm9ybSxcclxuICAgIHByb2ZpbGVFZGl0TmFtZUlucHV0LFxyXG4gICAgcHJvZmlsZUVkaXRKb2JJbnB1dCxcclxuICAgIGVkaXRBdmF0YXJCdXR0b24sXHJcbiAgICBhdmF0YXJQaWN0dXJlLFxyXG59XHJcbiAgICBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBmb3JtQ29uZmlnIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgUG9wVXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wVXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IFBvcFVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wVXBXaXRoQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IFwiLi4vcGFnZXMvaW5kZXguY3NzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XHJcblxyXG4vL3Rlc2luZyB0aGUgQVBJXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gICAgdXJsOiAnaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjEnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246ICdhMDg3ZGE1OS02YWExLTRkYmYtOGEyYy05ODJlOTdkYTYwODAnLFxyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICB9LFxyXG59KTtcclxuXHJcbi8vbG9hZGluZyB1c2VyIGRhdGFcclxuYXBpLmdldENhcmRzQW5kVXNlckRhdGEoKS50aGVuKChyZXMpID0+IHtcclxuICAgIHJlc1swXS5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbmV3Q2FyZCA9IGNyZWF0ZUNhcmQoe1xyXG4gICAgICAgICAgICBuYW1lOiBjYXJkLm5hbWUsXHJcbiAgICAgICAgICAgIGxpbms6IGNhcmQubGluayxcclxuICAgICAgICAgICAgaWQ6IGNhcmQuX2lkLFxyXG4gICAgICAgICAgICBsaWtlU3RhdHVzOiBjYXJkLmlzTGlrZWRcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNhcmRMaXN0LmFkZEl0ZW0obmV3Q2FyZCk7XHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IHsgYXZhdGFyLCBhYm91dCwgbmFtZSB9ID0gcmVzWzFdO1xyXG4gICAgYXZhdGFyUGljdHVyZS5zcmMgPSBhdmF0YXI7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7bmFtZSwgYWJvdXR9KTtcclxufSlcclxuXHJcbi8vbW9kYWwgcmVsYXRlZCBjb2RlIGFuZCBpIGNhbGxiYWNrc1xyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbygnI3VzZXItbmFtZScsICcjdXNlci1jYXJlZXInKTtcclxuXHJcbmNvbnN0IGVubGFyZ2VJbWFnZU1vZGFsID0gbmV3IFBvcFVwV2l0aEltYWdlKCcjZW5sYXJnZWQtbW9kYWwtYm94Jyk7XHJcblxyXG5jb25zdCBjb25maXJtYXRpb25Nb2RhbCA9IG5ldyBQb3BVcFdpdGhDb25maXJtYXRpb24oJyNjb25maXJtLW1vZGFsJywgKGRhdGEpID0+IHtcclxuICAgIHJlbW92ZUNhcmQoZGF0YSwgZGF0YS5faWQpO1xyXG4gICAgY29uZmlybWF0aW9uTW9kYWwuY2xvc2UoKTtcclxufSk7XHJcblxyXG5jb25zdCBlZGl0QXZhdGFyTW9kYWwgPSBuZXcgUG9wVXBXaXRoRm9ybSgnI2F2YXRhci1lZGl0LW1vZGFsJywgKGRhdGEpID0+IHtcclxuICAgIGVkaXRBdmF0YXJNb2RhbC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gICAgYXBpLnVwZGF0ZVByb2ZpbGVQaWMoZGF0YVtcImF2YXRhci1saW5rXCJdKVxyXG4gICAgLnRoZW4ocmVzID0+IGF2YXRhclBpY3R1cmUuc3JjID0gcmVzLmF2YXRhcilcclxuICAgIC50aGVuKGVkaXRBdmF0YXJNb2RhbC5yZW5kZXJMb2FkaW5nKGZhbHNlKSlcclxuICAgIC5maW5hbGx5KGVkaXRBdmF0YXJNb2RhbC5jbG9zZSgpKVxyXG4gICAgLy93ZSB3aWxsIGFsc28gaW50ZXJtaXR0bmVseSBhZGQgYSBtZXRob2QgY2FsbCBoZXJlIGZvciB0aGUgJ1NhdmluZycsIHNhbWUgd2lsbCBnbyBmb3IgdXBsb2FkaW5nIGNhcmRzXHJcbn0pO1xyXG5cclxuY29uc3QgYWRkSW1hZ2VNb2RhbCA9IG5ldyBQb3BVcFdpdGhGb3JtKFwiI2FkZC1tb2RhbC1ib3hcIiwgKGRhdGEpID0+IHtcclxuICAgIGFkZEltYWdlTW9kYWwucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICAgIGFwaS51cGxvYWRDYXJkKGRhdGFbXCJhZGQtaW1nLXRpdGxlXCJdLCBkYXRhW1wiYWRkLWltZy1saW5rXCJdKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBsaW5rLCBfaWQsIGlzTGlrZWQgfSA9IHJlc1xyXG4gICAgICAgICAgICBjYXJkTGlzdC5wcmVwZW5kSXRlbShjcmVhdGVDYXJkKHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICAgICAgaWQ6IF9pZCxcclxuICAgICAgICAgICAgICAgIGxpa2VTdGF0dXM6IGlzTGlrZWRcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihhZGRJbWFnZU1vZGFsLnJlbmRlckxvYWRpbmcoZmFsc2UpKVxyXG4gICAgICAgIC5maW5hbGx5KGFkZEltYWdlTW9kYWwuY2xvc2UoKSlcclxufSk7XHJcblxyXG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gbmV3IFBvcFVwV2l0aEZvcm0oXCIjcHJvZmlsZS1tb2RhbC1ib3hcIiwgKGRhdGEpID0+IHtcclxuICAgIGVkaXRBdmF0YXJNb2RhbC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG4gICAgYXBpLnNldFByb2ZpbGVEYXRhXHJcbiAgICAoZGF0YVtcInByb2ZpbGUtbW9kYWwtdXNlcm5hbWVcIl0sIGRhdGFbXCJwcm9maWxlLW1vZGFsLWRlc2NcIl0pXHJcbiAgICAudGhlbihyZXMgPT4gdXNlckluZm8uc2V0VXNlckluZm8ocmVzKSlcclxuICAgIC50aGVuKGFkZEltYWdlTW9kYWwucmVuZGVyTG9hZGluZyhmYWxzZSkpXHJcbiAgICAuZmluYWxseShlZGl0UHJvZmlsZU1vZGFsLmNsb3NlKCkpXHJcbn0pO1xyXG5cclxuZWRpdFByb2ZpbGVNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5hZGRJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmVubGFyZ2VJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmNvbmZpcm1hdGlvbk1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmVkaXRBdmF0YXJNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy9mdW5jdGlvbnNcclxuZnVuY3Rpb24gY3JlYXRlQ2FyZChpdGVtKSB7XHJcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoaXRlbSwgXCIjY2FyZC10ZW1wbGF0ZVwiLCBcclxuICAgICgpID0+IHtlbmxhcmdlSW1hZ2VNb2RhbC5vcGVuKGl0ZW0ubmFtZSwgaXRlbS5saW5rKX0sIFxyXG4gICAgKCkgPT4geyBjb25maXJtYXRpb25Nb2RhbC5vcGVuKGNhcmQsIGNhcmQuX2lkKSB9LFxyXG4gICAgKCkgPT4ge1xyXG4gICAgICAgIGlmICghaXRlbS5saWtlU3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGFwaS5saWtlQ2FyZChpdGVtLmlkKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVDYXJkRGF0YShpdGVtLCByZXMuaXNMaWtlZCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXBpLnVubGlrZUNhcmQoaXRlbS5pZCkudGhlbihyZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlQ2FyZERhdGEoaXRlbSwgcmVzLmlzTGlrZWQpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmQuZ2VuZXJhdGVDYXJkKCk7XHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUNhcmREYXRhKGl0ZW0sIG5ld0l0ZW1EYXRhKSB7XHJcbiAgICBpdGVtLmxpa2VTdGF0dXMgPSBuZXdJdGVtRGF0YTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVtb3ZlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XHJcbiAgICBhcGkuZGVsZXRlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgIGNhcmRFbGVtZW50LmRlbGV0ZSgpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSlcclxufVxyXG5cclxuLy9jYXJkIHJlbmRlcmluZyBzZWN0aW9uIGFuZCByZW5kZXJpbmdcclxuY29uc3QgY2FyZExpc3QgPSBuZXcgU2VjdGlvbih7XHJcbiAgICBpdGVtczogW10sXHJcbiAgICByZW5kZXJlcjogKCkgPT4geyB9XHJcbn0sICcuY2FyZHMnKTtcclxuXHJcbmNhcmRMaXN0LnJlbmRlckl0ZW1zKCk7XHJcblxyXG4vL2VuYWJsaW5nIGZvcm0gdmFsaWRhdGlvblxyXG5jb25zdCBhZGRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYWRkSW1hZ2VFZGl0Rm9ybSk7XHJcbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgcHJvZmlsZUVkaXRGb3JtKTtcclxuY29uc3QgYXZhdGFyRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIGVkaXRBdmF0YXJGb3JtKTtcclxuXHJcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5lZGl0Rm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuLy9zZWN0aW9uIGZvciBldmVudCBoYW5kbGVyc1xyXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBlZGl0UHJvZmlsZU1vZGFsLm9wZW4oKTtcclxuICAgIGNvbnN0IHsgbmFtZSwgam9iIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG4gICAgcHJvZmlsZUVkaXROYW1lSW5wdXQudmFsdWUgPSBuYW1lO1xyXG4gICAgcHJvZmlsZUVkaXRKb2JJbnB1dC52YWx1ZSA9IGpvYjtcclxufSk7XHJcblxyXG5hZGRJbWFnZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgYWRkSW1hZ2VNb2RhbC5vcGVuKCk7XHJcbn0pO1xyXG5cclxuZWRpdEF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgZWRpdEF2YXRhck1vZGFsLm9wZW4oKTtcclxufSk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgdGhpcy51cmwgPSBvcHRpb25zLnVybDtcclxuICAgIHRoaXMuaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycztcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFVzZXJEYXRhKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMudXJsICsgJy91c2Vycy9tZScsIHtcclxuICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMudXJsICsgJy9jYXJkcycsIHtcclxuICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHVwbG9hZENhcmQobmFtZSwgbGluaykge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMudXJsICsgJy9jYXJkcycsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgbGluazogbGlua1xyXG4gICAgICB9KVxyXG4gICAgfSkudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBkZWxldGVDYXJkKGNhcmRJZCkge1xyXG4gICAgZmV0Y2godGhpcy51cmwgKyBgL2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENhcmRzQW5kVXNlckRhdGEoKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckRhdGEoKV0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICAvL3RoaXMgd2lsbCBiZSBvdXQgbWV0aG9kIHRvIGhhdmUgbGlrZXMgaW4gYSBjYXJkXHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy51cmwgKyBgL2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHVubGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy51cmwgKyBgL2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIG90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXHJcbiAgYXN5bmMgc2V0UHJvZmlsZURhdGEobmFtZSwgYWJvdXQpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLnVybCArICcvdXNlcnMvbWUnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBhYm91dDogYWJvdXRcclxuICAgICAgfSlcclxuICAgIH0pLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBkYXRlUHJvZmlsZVBpYyh1cmwpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLnVybCArICcvdXNlcnMvbWUvYXZhdGFyJywge1xyXG4gICAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogdXJsXHJcbiAgICAgIH0pXHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8vd2Ugd2lsbCBuZWVkIHRvIGZpbmQgYSB3YXkgdG8gaGF2ZSB0aGUgcmVzcGVjdGl2ZSBwb3B1cHMgaGF2ZSBhIGxvYWRpbmcgcGhhc2UuLnRoZXJlIGlzIGEgcmVzb3VyY2UgaW4gdGhlIGxlc3NvbnMgSSBjYW4gYWN0dWFsbHkgdXNlXHJcbi8vd2Ugd2lsbCBhZGQgYSBuZXcgbGl0dGxlIGVsZW1lbnQgaW4gdGhlIGNhcmQgb2JqZWN0IHRvIHNob3cgdGhlIGxpa2VzIGFzIGFuIGludGVnZXIiLCJcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm97XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lU2VsZWN0b3IsIGpvYlNlbGVjdG9yKXtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZVNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihqb2JTZWxlY3Rvcik7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckluZm8oKXtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgICAgICAgam9iOiB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyhpbmZvKXtcclxuICAgICAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGluZm8ubmFtZTtcclxuICAgICAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ID0gaW5mby5hYm91dDtcclxuICAgIH1cclxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wVXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cHtcclxuICAgIGNvbnN0cnVjdG9yKG1vZGFsKXtcclxuICAgICAgIHN1cGVyKG1vZGFsKTtcclxuICAgICAgIHRoaXMuX21vZGFsSW1hZ2UgPSB0aGlzLl9tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2VubGFyZ2VkLWltYWdlJyk7XHJcbiAgICAgICB0aGlzLl9tb2RhbENhcHRpb24gPSB0aGlzLl9tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2VubGFyZ2VkLXRleHQnKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKG5hbWUsIGxpbmspe1xyXG4gICAgICAgIHRoaXMuX21vZGFsSW1hZ2Uuc2V0QXR0cmlidXRlKCdzcmMnLCBsaW5rKTtcclxuICAgICAgICB0aGlzLl9tb2RhbEltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JywgbmFtZSk7XHJcbiAgICAgICAgdGhpcy5fbW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgICAgICBzdXBlci5vcGVuKCk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aENvbWZpcm1hdGlvbiBleHRlbmRzIFBvcHVwe1xyXG4gICAgY29uc3RydWN0b3IobW9kYWwsIGhhbmRsZUZvcm1TdWJtaXQpe1xyXG4gICAgICAgIHN1cGVyKG1vZGFsKTtcclxuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgICAgICB0aGlzLl9tb2RhbEZvcm0gPSB0aGlzLl9tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Zvcm0nKTtcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9tb2RhbEZvcm0ucXVlcnlTZWxlY3RvcignLm1vZGFsX19idXR0b24nKTtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuKGNhcmRFbGVtZW50LCBjYXJkSWQpe1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKTtcclxuICAgICAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuX2lkID0gY2FyZElkO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb3NlKCl7XHJcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRFdmVudExpc3RlbmVycygpe1xyXG4gICAgICAgIHRoaXMuX21vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9jYXJkRWxlbWVudCwgdGhpcy5faWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG5cclxuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKGVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByZXBlbmRJdGVtKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59Il0sIm5hbWVzIjpbImZvcm1Db25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImVkaXRCdXR0b24iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRJbWFnZUJ1dHRvbiIsInByb2ZpbGVFZGl0Rm9ybSIsImFkZEltYWdlRWRpdEZvcm0iLCJlZGl0QXZhdGFyRm9ybSIsInByb2ZpbGVFZGl0TmFtZUlucHV0IiwicHJvZmlsZUVkaXRKb2JJbnB1dCIsImVkaXRBdmF0YXJCdXR0b24iLCJhdmF0YXJQaWN0dXJlIiwiQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZUNhcmREZWxldGUiLCJoYW5kbGVDYXJkTGlrZSIsIm5hbWUiLCJsaW5rIiwiaWQiLCJsaWtlU3RhdHVzIiwidGhpcyIsIl9uYW1lIiwiX2xpbmsiLCJfaWQiLCJfbGlrZVN0YXR1cyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJfaGFuZGxlQ2FyZExpa2UiLCJfaGFuZGxlTGlrZUJ1dHRvbiIsIl9jYXJkRWxlbWVudCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJfY2hlY2tTdGF0dXMiLCJkZWxldGUiLCJyZW1vdmUiLCJsaWtlQnV0dG9uIiwiYWRkIiwiZ2VuZXJhdGVDYXJkIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUZXh0IiwiY2FyZEltYWdlIiwidGV4dENvbnRlbnQiLCJzZXRBdHRyaWJ1dGUiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtIiwiX2lucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsIl9mb3JtIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiaW5wdXRFcnJvckVsZW1lbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0TGlzdCIsImV2ZXJ5IiwiaW5wdXQiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfaW5wdXRMaXN0IiwiX2Rpc2FibGVCdXR0b24iLCJfYnV0dG9uRWxlbWVudCIsInJlbW92ZUF0dHJpYnV0ZSIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZW5hYmxlVmFsaWRhdGlvbiIsIlBvcHVwIiwibW9kYWwiLCJfbW9kYWwiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwiZXZ0Iiwia2V5IiwiY2xvc2UiLCJvcGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiY29udGFpbnMiLCJ0YXJnZXQiLCJQb3BVcFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX21vZGFsRm9ybSIsIl9tb2RhbEJ1dHRvbiIsIl9tb2RhbEJ1dHRvblRleHQiLCJfbW9kYWxJbnB1dHMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtRGF0YSIsIkZvcm1EYXRhIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwicmVzZXQiLCJhcGkiLCJvcHRpb25zIiwidXJsIiwiaGVhZGVycyIsImdldFVzZXJEYXRhIiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsInVwbG9hZENhcmQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJnZXRDYXJkc0FuZFVzZXJEYXRhIiwiYWxsIiwibGlrZUNhcmQiLCJ1bmxpa2VDYXJkIiwic2V0UHJvZmlsZURhdGEiLCJhYm91dCIsInVwZGF0ZVByb2ZpbGVQaWMiLCJhdmF0YXIiLCJhdXRob3JpemF0aW9uIiwiY2FyZCIsIm5ld0NhcmQiLCJjcmVhdGVDYXJkIiwiaXNMaWtlZCIsImNhcmRMaXN0IiwiYWRkSXRlbSIsInNyYyIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9qb2JFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJqb2IiLCJpbmZvIiwiZW5sYXJnZUltYWdlTW9kYWwiLCJfbW9kYWxJbWFnZSIsIl9tb2RhbENhcHRpb24iLCJjb25maXJtYXRpb25Nb2RhbCIsIl9zdWJtaXRCdXR0b24iLCJjYXJkRWxlbWVudCIsImRhdGEiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJlZGl0QXZhdGFyTW9kYWwiLCJmaW5hbGx5IiwiYWRkSW1hZ2VNb2RhbCIsInByZXBlbmRJdGVtIiwiZWRpdFByb2ZpbGVNb2RhbCIsIml0ZW0iLCJ1cGRhdGVDYXJkRGF0YSIsIm5ld0l0ZW1EYXRhIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImVsZW1lbnQiLCJhcHBlbmQiLCJwcmVwZW5kIiwicmVuZGVySXRlbXMiLCJhZGRGb3JtVmFsaWRhdG9yIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJhdmF0YXJGb3JtVmFsaWRhdG9yIiwidmFsdWUiXSwic291cmNlUm9vdCI6IiJ9